{% extends "dashboard/dashboard.html" %} {% load static %} {% block title %}Add
Team{% endblock %} {% block content %}
<div class="profile-update">
  <h1>Add Team</h1>

  <form
    action=""
    method="POST"
    class="form-ctrl"
    enctype="multipart/form-data"
    id="teamform"
  >
    {% csrf_token %}
    <div class="fields flex">
      <div class="left">
        <div class="field flex">
          <label>{{ form.name.label}} </label>{{form.name}}
        </div>
        <div class="field flex">
          <label>{{ form.sport.label}} </label>{{form.sport}}
        </div>
        <div class="field flex">
          <label>{{ form.gender.label}} </label>{{form.gender}}
        </div>
        <div class="field flex">
          <label>{{ form.age.label}} </label>{{form.age}}
        </div>
        <div class="field flex">
          <label>{{ form.championship.label}} </label>{{form.championship}}
        </div>
      </div>
      <div class="other-fields">
        <div class="field flex">
          <label>{{ form.athletes.label}} </label>
          <div id="id_athletes" class="form-control athletes"></div>
        </div>
      </div>
    </div>
    <button type="submit" class="btn-submit">Add team</button>
    {% if form.errors %}
    <ul class="errorlist">
      {% for field, errors in form.errors.items %} {% for error in errors %}
      <li>{{ field|title }}: {{ error }}</li>
      {% endfor %} {% endfor %}
    </ul>
    {% endif %}
  </form>

</div>
  <script>
    function get_athletes() {
      var sport_select = document.getElementById("id_sport");
      var gender_select = document.getElementById("id_gender");
      var age_select = document.getElementById("id_age");
      var athlete_select = document.querySelector(".athletes");

      // Show loading indicator for athletes
      athlete_select.innerHTML = "<p>Loading athletes...</p>";

      // Fetch athletes for the selected sport, gender, and age using AJAX
      var sport_id = sport_select.value;
      var gender = gender_select.value;
      var age_id = age_select.value;

      // Construct the URL with the selected parameters
      var url = `/get_athletes/?sport_id=${sport_id}&gender=${gender}&age_id=${age_id}`;

      console.log(`Fetching from URL: ${url}`);

      fetch(url)
        .then((response) => {
          console.log(`Response status: ${response.status}`);
          return response.json();
        })
        .then((data) => {
    
          // Hide the loading indicator for athletes
          athlete_select.innerHTML = "";

          // Update the 'athlete' checkbox list with the fetched data
          if (data.athletes.length === 0) {
            athlete_select.innerHTML = "<p>No athletes found.</p>";
          } else {
            data.athletes.forEach((athlete) => {
              var div = document.createElement("div");
              var label = document.createElement("label");
              var input = document.createElement("input");
              input.type = "checkbox";
              input.value = athlete.id;
              input.name = "athletes"; // Ensure this is the correct name
              label.innerText = athlete.fname;
              div.appendChild(input);
              div.appendChild(label);
              athlete_select.appendChild(div);
            });
          }
        })
        .catch((error) => {
          console.error("Error fetching athletes:", error);
          athlete_select.innerHTML =
            "<p>Error fetching athletes. Please try again.</p>";
        });
    }

    document.addEventListener("DOMContentLoaded", function () {
      // Attach the get_athletes function to the onchange events of the sport, gender, and age elements
      document.getElementById("id_sport").onchange = get_athletes;
      document.getElementById("id_gender").onchange = get_athletes;
      document.getElementById("id_age").onchange = get_athletes;
    });

    document.addEventListener("DOMContentLoaded", function () {
      // Attach the get_athletes function to the onchange events of the sport, gender, and age elements
      document.getElementById("id_sport").onchange = get_athletes;
      document.getElementById("id_gender").onchange = get_athletes;
      document.getElementById("id_age").onchange = get_athletes;
    });
  </script>
{% endblock %}
